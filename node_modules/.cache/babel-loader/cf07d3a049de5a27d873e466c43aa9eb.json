{"ast":null,"code":"import _objectSpread from\"/Users/paulndam/Documents/Node-Js/Sample-Mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/paulndam/Documents/Node-Js/Sample-Mern/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import Paper from\"@material-ui/core/Paper\";import React,{useState,useEffect}from\"react\";import{Redirect,Link}from\"react-router-dom\";import{read,follow}from\"../../api/UserApi/userApi\";import auth from\"../../utils/Auth/authHelper\";import MenuBar from\"../Menu/MenuBar\";import{makeStyles}from\"@material-ui/core/styles\";import List from\"@material-ui/core/List\";import ListItem from\"@material-ui/core/ListItem\";import ListItemAvatar from\"@material-ui/core/ListItemAvatar\";import ListItemSecondaryAction from\"@material-ui/core/ListItemSecondaryAction\";import ListItemText from\"@material-ui/core/ListItemText\";import Avatar from\"@material-ui/core/Avatar\";import IconButton from\"@material-ui/core/IconButton\";import Typography from\"@material-ui/core/Typography\";import Edit from\"@material-ui/icons/Edit\";import Person from\"@material-ui/icons/Person\";import Divider from\"@material-ui/core/Divider\";import DeleteUser from\"./DeleteUser\";import Footer from\"../Footer/Footer\";import FollowButtons from\"../Follow/FollowButtons\";import ProfileTab from\"./ProfileTab\";import{listByUser}from\"../../api/PostApi/postApi\";import LoadingSpinner from\"../../pages/Spinner/LoadingSpinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:theme.mixins.gutters({maxWidth:600,margin:\"auto\",padding:theme.spacing(3),marginTop:theme.spacing(5)}),title:{marginTop:theme.spacing(3),color:theme.palette.protectedTitle},textDec:{textDecoration:\"none\"}};});var Profile=function Profile(_ref){var _values$user;var match=_ref.match;// This profile information can be fetched from the server only if the user is signed in, and to verify this, the component has to provide the JWT to the read fetch call, otherwise, the user should be redirected to the Sign In view.\nvar classes=useStyles();var _useState=useState({user:{following:[],followers:[]},redirectToSignin:false,following:false}),_useState2=_slicedToArray(_useState,2),values=_useState2[0],setValues=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),posts=_useState4[0],setPosts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];//const [redirectToSignIn, setRedirectToSignIn] = useState(false);\nvar jwt=auth.isAuthenticated();useEffect(function(){var abortController=new AbortController();var signal=abortController.signal;setLoading(true);read({userId:match.params.userId},{t:jwt.token},signal).then(function(data){console.log(\"--- Data In UseEffect ---\");console.log(data);if(data&&data.error){setValues(_objectSpread(_objectSpread({},values),{},{redirectToSignin:true}));}else{setLoading(false);var following=checkFollow(data);console.log(\"-----Checking following in UseEffect----\");console.log(following);setValues(_objectSpread(_objectSpread({},values),{},{user:data,following:following}));loadPosts(data._id);}});return function cleanup(){abortController.abort();};},[match.params.userId]);/*\n  the checkFollow method will check if the signed-in user exists in the fetched user's followers list, then return the match if found, otherwise return undefined if a match is not found.\n  */var checkFollow=function checkFollow(user){var match=user.followers.some(function(follower){return follower._id===jwt.user._id;});console.log(\"---- match ---\");console.log(match);return match;};var clickFollowButton=function clickFollowButton(callApi){var jwt=auth.isAuthenticated();console.log(\"--- JWT From ClickFollow button in Profile ---\");console.log(jwt);callApi({userId:jwt.user._id},{t:jwt.token},values.user._id).then(function(data){console.log(\"---Data From ClickFollowButton in Profile Component ----\");console.log(data);if(data.error){setValues(_objectSpread(_objectSpread({},values),{},{error:data.error}));console.log(data.error);}else{setValues(_objectSpread(_objectSpread({},values),{},{user:data,following:!values.following}));}});};// this method will fetch the api that will load all the post of a unique user. we will make use of the listByUser api call method .\nvar loadPosts=function loadPosts(user){setLoading(true);listByUser({userId:user},{t:jwt.token}).then(function(data){console.log(\"-- post of a unique user in their profile --\");console.log(data);if(data.error){console.log(data.error);}else{setLoading(false);setPosts(data);}});};// removing post as well.\nvar removePost=function removePost(post){var updatedPosts=posts;var index=updatedPosts.indexOf(post);updatedPosts.splice(index,1);setPosts(updatedPosts);};var photoUrl=values.user._id&&\"\".concat(process.env.REACT_APP_API,\"/users/photo/\").concat(values.user._id,\"?\").concat(new Date().getTime());if(values.redirectToSignIn){return/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(MenuBar,{}),loading?/*#__PURE__*/_jsx(LoadingSpinner,{}):/*#__PURE__*/_jsxs(Paper,{className:classes.root,elevation:4,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",className:classes.title,children:values.user.followers.length===1?\"\".concat(values.user.followers.length,\" Follower\"):\"\".concat(values.user.followers.length,\" Followers\")}),/*#__PURE__*/_jsxs(List,{dense:true,children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{src:photoUrl,children:/*#__PURE__*/_jsx(Person,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:values.user.name,secondary:values.user.email}),\" \",/*#__PURE__*/_jsx(\"br\",{}),auth.isAuthenticated().user&&auth.isAuthenticated().user._id===values.user._id?/*#__PURE__*/_jsxs(ListItemSecondaryAction,{children:[/*#__PURE__*/_jsx(Link,{to:\"/user/edit/\".concat(values.user._id),className:classes.textDec,children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"Edit\",color:\"primary\",children:/*#__PURE__*/_jsx(Edit,{})})}),/*#__PURE__*/_jsx(DeleteUser,{userId:values.user._id})]}):/*#__PURE__*/_jsx(FollowButtons,{following:values.following,onButtonClick:clickFollowButton})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"About: \".concat(values.user.about===\"undefined\"?\"ðŸ¤ \":values.user.about)})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Joined: \"+new Date((_values$user=values.user)===null||_values$user===void 0?void 0:_values$user.created).toDateString()})})]}),/*#__PURE__*/_jsx(ProfileTab,{user:values.user,posts:posts,removePostUpdate:removePost})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default Profile;","map":{"version":3,"sources":["/Users/paulndam/Documents/Node-Js/Sample-Mern/client/src/components/Users/Profile.jsx"],"names":["Paper","React","useState","useEffect","Redirect","Link","read","follow","auth","MenuBar","makeStyles","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemText","Avatar","IconButton","Typography","Edit","Person","Divider","DeleteUser","Footer","FollowButtons","ProfileTab","listByUser","LoadingSpinner","useStyles","theme","root","mixins","gutters","maxWidth","margin","padding","spacing","marginTop","title","color","palette","protectedTitle","textDec","textDecoration","Profile","match","classes","user","following","followers","redirectToSignin","values","setValues","posts","setPosts","loading","setLoading","jwt","isAuthenticated","abortController","AbortController","signal","userId","params","t","token","then","data","console","log","error","checkFollow","loadPosts","_id","cleanup","abort","some","follower","clickFollowButton","callApi","removePost","post","updatedPosts","index","indexOf","splice","photoUrl","process","env","REACT_APP_API","Date","getTime","redirectToSignIn","length","name","email","about","created","toDateString"],"mappings":"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","sourcesContent":["import Paper from \"@material-ui/core/Paper\";\nimport React, { useState, useEffect } from \"react\";\nimport { Redirect, Link } from \"react-router-dom\";\nimport { read, follow } from \"../../api/UserApi/userApi\";\nimport auth from \"../../utils/Auth/authHelper\";\nimport MenuBar from \"../Menu/MenuBar\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Edit from \"@material-ui/icons/Edit\";\nimport Person from \"@material-ui/icons/Person\";\nimport Divider from \"@material-ui/core/Divider\";\nimport DeleteUser from \"./DeleteUser\";\nimport Footer from \"../Footer/Footer\";\nimport FollowButtons from \"../Follow/FollowButtons\";\nimport ProfileTab from \"./ProfileTab\";\nimport { listByUser } from \"../../api/PostApi/postApi\";\nimport LoadingSpinner from \"../../pages/Spinner/LoadingSpinner\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: theme.mixins.gutters({\n    maxWidth: 600,\n    margin: \"auto\",\n    padding: theme.spacing(3),\n    marginTop: theme.spacing(5),\n  }),\n  title: {\n    marginTop: theme.spacing(3),\n    color: theme.palette.protectedTitle,\n  },\n  textDec: {\n    textDecoration: \"none\",\n  },\n}));\n\nconst Profile = ({ match }) => {\n  // This profile information can be fetched from the server only if the user is signed in, and to verify this, the component has to provide the JWT to the read fetch call, otherwise, the user should be redirected to the Sign In view.\n  const classes = useStyles();\n  const [values, setValues] = useState({\n    user: { following: [], followers: [] },\n    redirectToSignin: false,\n    following: false,\n  });\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  //const [redirectToSignIn, setRedirectToSignIn] = useState(false);\n  const jwt = auth.isAuthenticated();\n\n  useEffect(() => {\n    const abortController = new AbortController();\n    const signal = abortController.signal;\n    setLoading(true);\n    read(\n      {\n        userId: match.params.userId,\n      },\n      { t: jwt.token },\n      signal\n    ).then((data) => {\n      console.log(\"--- Data In UseEffect ---\");\n      console.log(data);\n      if (data && data.error) {\n        setValues({ ...values, redirectToSignin: true });\n      } else {\n        setLoading(false);\n        let following = checkFollow(data);\n        console.log(\"-----Checking following in UseEffect----\");\n        console.log(following);\n        setValues({ ...values, user: data, following: following });\n        loadPosts(data._id);\n      }\n    });\n    return function cleanup() {\n      abortController.abort();\n    };\n  }, [match.params.userId]);\n\n  /*\n  the checkFollow method will check if the signed-in user exists in the fetched user's followers list, then return the match if found, otherwise return undefined if a match is not found.\n  */\n\n  const checkFollow = (user) => {\n    const match = user.followers.some((follower) => {\n      return follower._id === jwt.user._id;\n    });\n    console.log(\"---- match ---\");\n    console.log(match);\n    return match;\n  };\n\n  const clickFollowButton = (callApi) => {\n    const jwt = auth.isAuthenticated();\n    console.log(\"--- JWT From ClickFollow button in Profile ---\");\n    console.log(jwt);\n    callApi({ userId: jwt.user._id }, { t: jwt.token }, values.user._id).then(\n      (data) => {\n        console.log(\"---Data From ClickFollowButton in Profile Component ----\");\n        console.log(data);\n        if (data.error) {\n          setValues({ ...values, error: data.error });\n          console.log(data.error);\n        } else {\n          setValues({ ...values, user: data, following: !values.following });\n        }\n      }\n    );\n  };\n\n  // this method will fetch the api that will load all the post of a unique user. we will make use of the listByUser api call method .\n\n  const loadPosts = (user) => {\n    setLoading(true);\n    listByUser({ userId: user }, { t: jwt.token }).then((data) => {\n      console.log(\"-- post of a unique user in their profile --\");\n      console.log(data);\n      if (data.error) {\n        console.log(data.error);\n      } else {\n        setLoading(false);\n        setPosts(data);\n      }\n    });\n  };\n\n  // removing post as well.\n  const removePost = (post) => {\n    const updatedPosts = posts;\n    const index = updatedPosts.indexOf(post);\n    updatedPosts.splice(index, 1);\n    setPosts(updatedPosts);\n  };\n\n  const photoUrl =\n    values.user._id &&\n    `${process.env.REACT_APP_API}/users/photo/${\n      values.user._id\n    }?${new Date().getTime()}`;\n\n  if (values.redirectToSignIn) {\n    return <Redirect to=\"/signin\" />;\n  }\n\n  return (\n    <div>\n      <MenuBar />\n      {loading ? (\n        <LoadingSpinner />\n      ) : (\n        <Paper className={classes.root} elevation={4}>\n          <Typography variant=\"h6\" className={classes.title}>\n            {values.user.followers.length === 1\n              ? `${values.user.followers.length} Follower`\n              : `${values.user.followers.length} Followers`}\n          </Typography>\n          <List dense>\n            <ListItem>\n              <ListItemAvatar>\n                <Avatar src={photoUrl}>\n                  <Person />\n                </Avatar>\n              </ListItemAvatar>\n              <ListItemText\n                primary={values.user.name}\n                secondary={values.user.email}\n              />{\" \"}\n              <br />\n              {auth.isAuthenticated().user &&\n              auth.isAuthenticated().user._id === values.user._id ? (\n                <ListItemSecondaryAction>\n                  <Link\n                    to={`/user/edit/${values.user._id}`}\n                    className={classes.textDec}\n                  >\n                    <IconButton aria-label=\"Edit\" color=\"primary\">\n                      <Edit />\n                    </IconButton>\n                  </Link>\n                  <DeleteUser userId={values.user._id} />\n                </ListItemSecondaryAction>\n              ) : (\n                <FollowButtons\n                  following={values.following}\n                  onButtonClick={clickFollowButton}\n                />\n              )}\n            </ListItem>\n            <Divider />\n            <ListItem>\n              <ListItemText\n                primary={`About: ${\n                  values.user.about === \"undefined\" ? \"ðŸ¤ \" : values.user.about\n                }`}\n              ></ListItemText>\n            </ListItem>\n            <Divider />\n            <ListItem>\n              <ListItemText\n                primary={\n                  \"Joined: \" + new Date(values.user?.created).toDateString()\n                }\n              />\n            </ListItem>\n          </List>\n          <ProfileTab\n            user={values.user}\n            posts={posts}\n            removePostUpdate={removePost}\n          />\n        </Paper>\n      )}\n      <Footer />\n    </div>\n  );\n};\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}